sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/m/MessageToast","../model/formatter","webjavasapui5/model/models"],(e,t,o,s,n,a,r,i)=>{"use strict";return e.extend("webjavasapui5.controller.ListPage",{formatter:r,onInit(){this._loadRolesAndDepartments();const e=i.createUserInfoModel(this.getOwnerComponent());this.getView().setModel(e,"userInfo");if(e.attachEvent){e.attachEvent("userInfoReady",function(){console.log("userInfo (LP):",e.getData());console.log("userRole (LP):",e.getProperty("/userRole"))})}const t=sap.ui.getCore().getEventBus();t.subscribe("employee","dataChanged",this._onEmployeeDataChanged,this)},onExit(){const e=sap.ui.getCore().getEventBus();e.unsubscribe("employee","dataChanged",this._onEmployeeDataChanged,this)},_onEmployeeDataChanged(){this._refreshEmployeeData()},_refreshEmployeeData(){const e=this.byId("employeeTable");if(e){const t=e.getBinding("items");if(t){t.refresh()}}},_loadRolesAndDepartments(){const e=this.getOwnerComponent().getModel();const o=new t({filters:{department:"",level:""}});this.getView().setModel(o,"search");const s=e.bindList("/Roles");s.requestContexts().then(e=>{const t=e.map(e=>e.getObject());const s=[{key:"",text:"All"}];t.forEach(e=>{s.push({key:e.ID||e.id,text:e.name||e.Name})});o.setProperty("/roles",s)}).catch(e=>{});const n=e.bindList("/Departments");n.requestContexts().then(e=>{const t=e.map(e=>e.getObject());const s=[{key:"",text:"All"}];t.forEach(e=>{s.push({key:e.ID||e.id,text:e.name||e.Name})});o.setProperty("/departments",s)}).catch(e=>{})},onSearchChange(){const e=this.getView().getModel("search");const t=this.byId("employeeTable");const n=t.getBinding("items");const a=e.getProperty("/filters/department");const r=e.getProperty("/filters/role");const i=[];if(a){i.push(new o("department_ID",s.EQ,a))}if(r){i.push(new o("role_ID",s.EQ,r))}n.filter(i)},handleAddPress(){const e=this.getOwnerComponent().getRouter();e.navTo("RouteDetailPage",{employeeId:"new"})},handleEmpPress(){const e=this.getOwnerComponent().getRouter();e.navTo("RouteListPage")},onEditEmployee(e){const t=e.getSource().getBindingContext();const o=t.getObject();const s=this.getOwnerComponent().getRouter();s.navTo("RouteDetailPage",{employeeId:o.ID})},onRowSelect(e){var t=e.getParameter("listItem");var o=t.getBindingContext();var s=o.getObject();const n=this.getOwnerComponent().getRouter();n.navTo("RouteDetailPage",{employeeId:s.ID})},onDeleteEmployee(e){const t=e.getSource().getBindingContext();const o=t.getObject();const s=this.getView().getModel("i18n").getResourceBundle();n.confirm(s.getText("confirmDeleteMessage",[o.firstName,o.lastName]),{title:s.getText("confirmDeleteTitle"),onClose:e=>{if(e===n.Action.OK){this._deleteEmployee(t,o)}}})},_deleteEmployee(e,t){const o=this.getView().getModel("i18n").getResourceBundle();try{e.delete().then(()=>{a.show(o.getText("employeeDeletedMessage",[t.firstName,t.lastName]));this._refreshEmployeeData();const e=sap.ui.getCore().getEventBus();e.publish("employee","dataChanged",{})}).catch(e=>{a.show(o.getText("errorDeletingMessage"))})}catch(e){a.show(o.getText("errorDeletingMessage"))}}})});
//# sourceMappingURL=ListPage.controller.js.map