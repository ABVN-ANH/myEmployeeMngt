sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/m/MessageToast","webjavasapui5/model/models","../model/formatter"],(e,t,o,s,n,a,r,l)=>{"use strict";return e.extend("webjavasapui5.controller.ListPage",{formatter:l,onInit(){this._loadRolesAndDepartments();const e=r.createUserInfoModel(this.getOwnerComponent());this.getView().setModel(e,"userInfo");if(e.attachEvent){e.attachEvent("userInfoReady",()=>{console.log("userInfo (LP):",e.getData());console.log("userRole (LP):",e.getProperty("/userRole"))})}sap.ui.getCore().getEventBus().subscribe("employee","dataChanged",this._onEmployeeDataChanged,this)},onExit(){sap.ui.getCore().getEventBus().unsubscribe("employee","dataChanged",this._onEmployeeDataChanged,this)},_onEmployeeDataChanged(){this._refreshEmployeeData()},_refreshEmployeeData(){const e=this.byId("employeeTable");if(e){const t=e.getBinding("items");if(t){t.refresh()}}},_loadRolesAndDepartments(){const e=this.getOwnerComponent().getModel();const o=new t({filters:{department:"",level:""}});this.getView().setModel(o,"search");e.bindList("/Roles").requestContexts().then(e=>{const t=[{key:"",text:"All"},...e.map(e=>{const t=e.getObject();return{key:t.ID||t.id,text:t.name||t.Name}})];o.setProperty("/roles",t)});e.bindList("/Departments").requestContexts().then(e=>{const t=[{key:"",text:"All"},...e.map(e=>{const t=e.getObject();return{key:t.ID||t.id,text:t.name||t.Name}})];o.setProperty("/departments",t)})},onSearchChange(){const e=this.getView().getModel("search");const t=this.byId("employeeTable");const n=t.getBinding("items");const a=e.getProperty("/filters/department");const r=e.getProperty("/filters/role");const l=[];if(a)l.push(new o("department_ID",s.EQ,a));if(r)l.push(new o("role_ID",s.EQ,r));n.filter(l)},handleCreateNewEmployeePress(){this.getOwnerComponent().getRouter().navTo("RouteDetailPage",{employeeId:"new"})},handleViewDetailEmployeePress(){this.getOwnerComponent().getRouter().navTo("RouteListPage")},handleUpdateEmployeePress(e){const t=e.getSource().getBindingContext().getObject();this.getOwnerComponent().getRouter().navTo("RouteDetailPage",{employeeId:t.ID})},onRowSelect(e){const t=e.getParameter("listItem").getBindingContext().getObject();this.getOwnerComponent().getRouter().navTo("RouteDetailPage",{employeeId:t.ID})},handleDeleteEmployeePress(e){const t=e.getSource().getBindingContext();const o=t.getObject();const s=this.getView().getModel("i18n").getResourceBundle();n.confirm(s.getText("confirmDeleteMessage",[o.firstName,o.lastName]),{title:s.getText("confirmDeleteTitle"),onClose:e=>{if(e===n.Action.OK){this._deleteEmployee(t,o)}}})},_deleteEmployee(e,t){const o=this.getView().getModel("i18n").getResourceBundle();e.delete().then(()=>{a.show(o.getText("employeeDeletedMessage",[t.firstName,t.lastName]));this._refreshEmployeeData();sap.ui.getCore().getEventBus().publish("employee","dataChanged",{})}).catch(()=>{a.show(o.getText("errorDeletingMessage"))})}})});
//# sourceMappingURL=ListPage.controller.js.map